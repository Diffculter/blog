<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>什么是闭包 | KrialY</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/blog/img/witch.ico">
    <meta name="description" content="KrialY">
    <link rel="preload" href="/blog/assets/css/0.styles.9bd91c97.css" as="style"><link rel="preload" href="/blog/assets/js/app.34681b4e.js" as="script"><link rel="preload" href="/blog/assets/js/2.3b0a5b51.js" as="script"><link rel="preload" href="/blog/assets/js/14.e8a1ddea.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.f6814326.js"><link rel="prefetch" href="/blog/assets/js/11.13a286eb.js"><link rel="prefetch" href="/blog/assets/js/12.5bf77b1c.js"><link rel="prefetch" href="/blog/assets/js/13.3c360f02.js"><link rel="prefetch" href="/blog/assets/js/15.d3fa364f.js"><link rel="prefetch" href="/blog/assets/js/16.d410f76e.js"><link rel="prefetch" href="/blog/assets/js/17.a6626fab.js"><link rel="prefetch" href="/blog/assets/js/18.628ad834.js"><link rel="prefetch" href="/blog/assets/js/19.f2d1bf74.js"><link rel="prefetch" href="/blog/assets/js/20.09063965.js"><link rel="prefetch" href="/blog/assets/js/21.11688d76.js"><link rel="prefetch" href="/blog/assets/js/22.66b05294.js"><link rel="prefetch" href="/blog/assets/js/23.fc11a55f.js"><link rel="prefetch" href="/blog/assets/js/24.1f45c701.js"><link rel="prefetch" href="/blog/assets/js/25.a11b9ec5.js"><link rel="prefetch" href="/blog/assets/js/26.0decdb5c.js"><link rel="prefetch" href="/blog/assets/js/3.db7620e6.js"><link rel="prefetch" href="/blog/assets/js/4.1f285f65.js"><link rel="prefetch" href="/blog/assets/js/5.a8ad7dfb.js"><link rel="prefetch" href="/blog/assets/js/6.a4410cb8.js"><link rel="prefetch" href="/blog/assets/js/7.31dfa360.js"><link rel="prefetch" href="/blog/assets/js/8.02257648.js"><link rel="prefetch" href="/blog/assets/js/9.2b1b09fe.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.9bd91c97.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">KrialY</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于作者" class="dropdown-title"><span class="title">关于作者</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/KrialY" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://mubu.com/doc/explore/34397" target="_blank" rel="noopener noreferrer" class="nav-link external">
  幕布
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于作者" class="dropdown-title"><span class="title">关于作者</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/KrialY" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://mubu.com/doc/explore/34397" target="_blank" rel="noopener noreferrer" class="nav-link external">
  幕布
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JavaScript</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/PAGE/2019-10-14-js-reg/" class="sidebar-link">正则表达式🐣</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/PAGE/2019-10-14-js-reg/#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/blog/PAGE/2019-10-14-js-reg/#模糊匹配" class="sidebar-link">模糊匹配</a></li><li class="sidebar-sub-header"><a href="/blog/PAGE/2019-10-14-js-reg/#横向匹配" class="sidebar-link">横向匹配</a></li><li class="sidebar-sub-header"><a href="/blog/PAGE/2019-10-14-js-reg/#纵向匹配" class="sidebar-link">纵向匹配</a></li><li class="sidebar-sub-header"><a href="/blog/PAGE/2019-10-14-js-reg/#字符范围简写" class="sidebar-link">字符范围简写</a></li><li class="sidebar-sub-header"><a href="/blog/PAGE/2019-10-14-js-reg/#量词简写" class="sidebar-link">量词简写</a></li><li class="sidebar-sub-header"><a href="/blog/PAGE/2019-10-14-js-reg/#多选分支" class="sidebar-link">多选分支</a></li><li class="sidebar-sub-header"><a href="/blog/PAGE/2019-10-14-js-reg/#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/blog/PAGE/2019-10-14-js-reg/#特别鸣谢" class="sidebar-link">特别鸣谢</a></li><li class="sidebar-sub-header"><a href="/blog/PAGE/2019-10-14-js-reg/#最后" class="sidebar-link">最后</a></li></ul></li><li><a href="/blog/PAGE/2019-10-14-js-func-code/" class="sidebar-link">函数式编程🐓</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/PAGE/2019-10-14-js-func-code/#在做不同的事情的情况下，可能是基于某一个相同的条件" class="sidebar-link">在做不同的事情的情况下，可能是基于某一个相同的条件</a></li><li class="sidebar-sub-header"><a href="/blog/PAGE/2019-10-14-js-func-code/#不要让你的函数，去影响到外部的变量" class="sidebar-link">不要让你的函数，去影响到外部的变量</a></li></ul></li><li><a href="/blog/PAGE/2019-11-11-js-scope/" aria-current="page" class="active sidebar-link">什么是闭包🐢</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/PAGE/2019-11-11-js-scope/#写在前边" class="sidebar-link">写在前边</a></li><li class="sidebar-sub-header"><a href="/blog/PAGE/2019-11-11-js-scope/#_1-什么是闭包？" class="sidebar-link">1 什么是闭包？</a></li><li class="sidebar-sub-header"><a href="/blog/PAGE/2019-11-11-js-scope/#_2-闭包的作用是什么？" class="sidebar-link">2 闭包的作用是什么？</a></li><li class="sidebar-sub-header"><a href="/blog/PAGE/2019-11-11-js-scope/#_3-闭包的应用场景" class="sidebar-link">3 闭包的应用场景</a></li><li class="sidebar-sub-header"><a href="/blog/PAGE/2019-11-11-js-scope/#_4-经典的闭包面试题" class="sidebar-link">4 经典的闭包面试题</a></li></ul></li><li><a href="/blog/PAGE/2019-11-18-js-func/" class="sidebar-link">map、reduce等总结🐥</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/PAGE/2019-11-18-js-func/#map" class="sidebar-link">map</a></li><li class="sidebar-sub-header"><a href="/blog/PAGE/2019-11-18-js-func/#filter" class="sidebar-link">filter</a></li><li class="sidebar-sub-header"><a href="/blog/PAGE/2019-11-18-js-func/#foreach" class="sidebar-link">foreach</a></li><li class="sidebar-sub-header"><a href="/blog/PAGE/2019-11-18-js-func/#reduce" class="sidebar-link">reduce</a></li><li class="sidebar-sub-header"><a href="/blog/PAGE/2019-11-18-js-func/#for-in" class="sidebar-link">for...in</a></li><li class="sidebar-sub-header"><a href="/blog/PAGE/2019-11-18-js-func/#for-of" class="sidebar-link">for...of</a></li><li class="sidebar-sub-header"><a href="/blog/PAGE/2019-11-18-js-func/#some" class="sidebar-link">some</a></li><li class="sidebar-sub-header"><a href="/blog/PAGE/2019-11-18-js-func/#every" class="sidebar-link">every</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ES6</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="写在前边"><a href="#写在前边" class="header-anchor">#</a> 写在前边</h2> <blockquote><p>转自 <a href="https://juejin.im/post/5dc6449ae51d452bd321252c" target="_blank" rel="noopener noreferrer">掘金<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <p>正在学习初学前端小伙伴，会感觉 HTML 和 CSS 太简单了，没什么挑战性。那是你没有学过 JS ，JS 中太多的概念初期学习的时候也是很懵逼的，比如 this、原型链、闭包等，即是重点，又是难点。但是你懂了之后会发现很简单，很好理解。</p> <p>因为闭包是每场面试基本都是必问的，不仅要知道理论，还要问你在实际项目中的实践，这部分内容很多人常常在实战中忽略掉。
今天的内容，就是 JS 中的一个重点，也是面试的必考点，项目中也经常使用到，那就是有请我们神圣的&quot;闭包&quot;出场。</p> <p>你可能没听说过这个名词，也可能听说了但是不理解它，不知道怎么使用它，那咱们从零开始用动画把“闭包”的概念弄的明明白白。</p> <h2 id="_1-什么是闭包？"><a href="#_1-什么是闭包？" class="header-anchor">#</a> 1 什么是闭包？</h2> <p>学习一个陌生的概念，我们首先要去明白是什么？也就是闭包是什么？要想完全掌握闭包，一定要清楚函数作用域、内存回收机制、作用域继承。我们就简单讲一下这几个概念。</p> <h3 id="_1-1-函数作用域"><a href="#_1-1-函数作用域" class="header-anchor">#</a> 1.1 函数作用域</h3> <p>作用域的概念，形象描述的话，可以认为它是一个封闭的空间，只允许在这个封闭的空间内进行一些操作，也将这个封闭空间称为私有作用域。在 JS 中，一个函数的执行就会在内存中创建一个私有作用域——封闭的空间。</p> <p><img src="http://www.almx.top/image/blog/scope-1.png" alt="scope-1"></p> <p><img src="http://www.almx.top/image/blog/scope-2.gif" alt="scope-2"></p> <p>比如在函数中定义一个变量，只能在函数这个私有作用域中使用（也就是封闭空间）。只要超出了这个作用域，就找不到该变量了。</p> <p>而且函数执行完成后，这个私有作用域（封闭的空间）就会销毁。有一种情况它是不会销毁的，那就是“闭包”，后边会讲到。</p> <h3 id="_1-2-内存回收机制"><a href="#_1-2-内存回收机制" class="header-anchor">#</a> 1.2 内存回收机制</h3> <p>内存回收机制就是不在用到的内存，我们系统就自动进行回收从而清理出空间供其他程序使用。那回收的规则是什么？</p> <p><img src="http://www.almx.top/image/blog/scope-3.png" alt="scope-3"></p> <p>内部函数引用着外部的函数的变量，外部的函数尽管执行完毕，作用域也不会销毁。从而形成了一种不销毁的私有作用域。</p> <p>某一变量或者对象被引用着，因此在回收的时候不会释放它，因为被引用代表着被使用，回收器不会对正在引用的变量或对象回收的。</p> <h3 id="_1-3-作用域继承"><a href="#_1-3-作用域继承" class="header-anchor">#</a> 1.3 作用域继承</h3> <p>所谓的作用域继承，就像是儿子可以继承父亲的财产一样。比如小鹿这里有一个大的盒子作为一个父级的作用域，然后在这个大的盒子里边放一个小的盒子，作为子作用域。我们规定可以在小盒子中获取到大盒子中的东西，大盒子不能获取小盒子里的东西就称为作用域继承。</p> <p><img src="http://www.almx.top/image/blog/scope-4.png" alt="scope-4"></p> <p>在 JS 中，道理是一样的，在一个函数里边我们再声明一个函数，内部函数可以访问外部函数作用域的变量，而外部的函数不能获取到内部函数的作用域变量。
那好，上边的这几个概念理解了之后，什么是闭包对你来说已经不是什么问题。
大白话说什么是闭包，那就是在一个函数里边再定义一个函数。这个内部函数一直保持有对外部函数中作用域的访问权限(小盒子一直可以有大盒子的访问权限)。</p> <p><img src="http://www.almx.top/image/blog/scope-5.png" alt="scope-5"></p> <p>函数执行，形成一个私有的作用域，保护里边的私有变量不受外界的干扰，除了保护私有变量外，还可以存储一些内容，这样的模式叫做闭包。</p> <h4 id="动画实现："><a href="#动画实现：" class="header-anchor">#</a> 动画实现：</h4> <p><img src="http://www.almx.top/image/blog/scope-6.gif" alt="scope-6"></p> <h2 id="_2-闭包的作用是什么？"><a href="#_2-闭包的作用是什么？" class="header-anchor">#</a> 2 闭包的作用是什么？</h2> <p>想必你对闭包还是有点懵懵懂懂，没关系，我们再继续深入了解。闭包主要的作用是什么呢？为什么要使用闭包呢？</p> <p>通过上边对闭包的解释，外部函数 return 内部函数，但是仍然还是可以有访问外部函数的作用域，因为外部一直保持着引用。这就让我们发现它的可用之处。</p> <p>不是有块作用域不销毁吗？我们可以用来保存一些内容，还可以用来保护一些私有的变量。我们总结出闭包有两个作用，分别为保护和保存。</p> <h2 id="_3-闭包的应用场景"><a href="#_3-闭包的应用场景" class="header-anchor">#</a> 3 闭包的应用场景</h2> <p>既然我们知道闭包的作用是保存和保护，那在实际项目中哪里用到了呢？</p> <h3 id="_3-1-保护作用"><a href="#_3-1-保护作用" class="header-anchor">#</a> 3.1 保护作用</h3> <p>团队开发时，每个开发者把自己的代码放在一个私有的作用域中，防止相互之间的变量命名冲突；把需要提供给别人的方法，通过 return 或 window.xxx 的方式暴露在全局下。</p> <blockquote><p>jQuery 的源码中也是利用了这种保护机制。</p></blockquote> <h3 id="_3-2-保存作用"><a href="#_3-2-保存作用" class="header-anchor">#</a> 3.2 保存作用</h3> <p>选项卡闭包的解决方案。我们经常在网页中使用选项卡，但是它存在一个问题，那就是索引引发的问题，其实和下边的经典面试题问题相同。</p> <h2 id="_4-经典的闭包面试题"><a href="#_4-经典的闭包面试题" class="header-anchor">#</a> 4 经典的闭包面试题</h2> <blockquote><p>循环绑定事件引发的索引什么问题？怎么解决这种问题？</p></blockquote> <p><img src="http://www.almx.top/image/blog/scope-7.png" alt="scope-7"></p> <p>此时运行程序，你会得出的结果都是 len 的数值。</p> <p>为什么会出现这种问题，我们如何解决呢？</p> <p>原因很简单，所有的事件绑定都是异步的，当触发点击事件，执行方法的时候，循环早就结束了。</p> <p>我们在多说一点，什么是同步什么是异步？</p> <blockquote><p>同步：JS 中当前这个任务没有完成，下面的任务都不会执行，只有等当前彻底完成，才会执行下面的任务。</p></blockquote> <blockquote><p>异步：JS 中的当前任务没有完成，需要等一会在完成，此时我们可以继续执行下面的任务。</p></blockquote> <h4 id="解决方案："><a href="#解决方案：" class="header-anchor">#</a> 解决方案：</h4> <p>当点击事件执行的时候，就会在私有作用域查找 i 的值，此时私有作用域没有 i ，就回去全局作用域查找，此时全局作用域的 i 已经被改变。所以说，要创建一个私有作用域的 i 。</p> <p>方法一，闭包的方式。闭包终于排上用场了，用来保存私有的变量。</p> <p><img src="http://www.almx.top/image/blog/scope-8.png" alt="scope-8"></p> <p>但是闭包解决又优点，也有缺点。优点就是通过创建私有作用域（闭包）方式解决，循环几次，就创建几个私有作用域（闭包），然后，每个私有作用域都有一个私有变量 i ，存的值分别是循环的值。</p> <p>缺点是生成多个不销毁的私有作用域（堆内存），对性能有一定的影响。</p> <p>方法二，使用自定义属性。我们给每个对象添加一个索引属性就 OK 了。</p> <p><img src="http://www.almx.top/image/blog/scope-9.png" alt="scope-9"></p> <p>终极解决方案，这是 ES6 中的知识，因为之前在 JS 中是没有块级作用域的概念的，到了 ES6 中就有了，Let 声明的变量就可以更好的解决上述问题。</p> <p><img src="http://www.almx.top/image/blog/scope-10.png" alt="scope-10"></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/PAGE/2019-10-14-js-func-code/" class="prev">
        函数式编程🐓
      </a></span> <span class="next"><a href="/blog/PAGE/2019-11-18-js-func/">
        map、reduce等总结🐥
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.34681b4e.js" defer></script><script src="/blog/assets/js/2.3b0a5b51.js" defer></script><script src="/blog/assets/js/14.e8a1ddea.js" defer></script>
  </body>
</html>
